#
# Alertas Sonoros
#
- alias: "Aviso Sonoro - Falar Temperatura do Ar"
  initial_state: off
  trigger:
  - platform: state
    entity_id: input_number.temperatura_ar
  action:
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: "{% if is_state(\"input_number.temperatura_ar\", \"17.0\") %}\n  Temperatura\
        \ em 17 graus. Vamos congelar!\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"18.0\") %}\n  Temperatura em 19 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"19.0\") %}\n  Temperatura em 19 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"20.0\") %}\n  Temperatura em 20 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"21.0\") %}\n  Temperatura em 21 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"22.0\") %}\n  Temperatura em 22 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"23.0\") %}\n  Temperatura em 23 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"24.0\") %}\n  Temperatura em 24 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"25.0\") %}\n  Temperatura em 25 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"26.0\") %}\n  Temperatura em 26 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"27.0\") %}\n  Temperatura em 27 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"28.0\") %}\n  Temperatura em 28 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"29.0\") %}\n  Temperatura em 29 graus.\n{% elif is_state(\"input_number.temperatura_ar\"\
        , \"30.0\") %}\n  Temperatura em 30 graus. Vamos pegar fogo!\n{% else %}\n\
        \  Temperatura erro.\n{% endif %}\n"
  - delay:
      seconds: 5
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: 'Temperatura externa é de {{ states.sensor.dark_sky_temperature.state | int }} graus.'

- alias: Aviso Sonoro - Porta entrada aberta
  hide_entity: false
  initial_state: off
  trigger:
  - platform: state
    entity_id: binary_sensor.porta_entrada
    from: 'off'
    to: 'on'
  action:
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: Seja bem vindo.
  - delay:
      milliseconds: 600
  - service: camera.snapshot
    data:
      entity_id: camera.camera_interna
      filename: '/tmp/snapshot.jpg'
  - service: notify.telegramrudi
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot
  - service: notify.telegramflavia
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot

#
# Notificações Telegram
#
- alias: 'Notificação: Luzez On/Off'
  initial_state: off
  trigger:
  - entity_id:
      - light.garagem
      - light.arandelas
      - light.arandela_varanda_suite
      - light.area_piscina
      - light.refretores_piscina
      - light.porta_de_entrada
      - light.varanda_suite
      - light.postes
      - light.lavanderia
      - light.banheiro_suite
      - light.banheiro_social
      - light.lavabo
      - light.cozinha_central
      - light.cozinha_pia
      - light.cozinha_bancada
      - light.cozinha_pendentes
      - light.sala_game_central
      - light.sala_game_spots
      - light.sala_game_trilhos
      - light.fita_led
      - light.jantar_ent_frente
      - light.jantar_ent_garagem
      - light.jantar
      - light.sala_estar_lustre
      - light.sala_estar_spots
      - light.quarto_frente
      - light.quarto_meio
      - light.corredor
      - light.suite
      - light.abajur_da_suite
      - light.closet
    from: 'off'
    platform: state
    to: 'on'
  - entity_id:
      - light.garagem
      - light.arandelas
      - light.arandela_varanda_suite
      - light.area_piscina
      - light.refretores_piscina
      - light.porta_de_entrada
      - light.varanda_suite
      - light.postes
      - light.lavanderia
      - light.banheiro_suite
      - light.banheiro_social
      - light.lavabo
      - light.cozinha_central
      - light.cozinha_pia
      - light.cozinha_bancada
      - light.cozinha_pendentes
      - light.sala_game_central
      - light.sala_game_spots
      - light.sala_game_trilhos
      - light.fita_led
      - light.jantar_ent_frente
      - light.jantar_ent_garagem
      - light.jantar
      - light.sala_estar_lustre
      - light.sala_estar_spots
      - light.quarto_frente
      - light.quarto_meio
      - light.corredor
      - light.suite
      - light.abajur_da_suite
      - light.closet
    from: 'on'
    platform: state
    to: 'off'
  action:
  - service: notify.telegramrudi
    data_template:
      message: >
        Luz: {{ trigger.to_state.attributes.friendly_name }} {{ trigger.to_state.state }}


- id: letsencrypt-renewal
  initial_state: 'on'
  alias: "Renova Let's Encrypt"
  trigger:
  - platform: time
    at: '00:00:00'
  action:
  - service: hassio.addon_restart
    data:
      addon: core_letsencrypt

#
# DESPERTADOR
#
- alias: "Conf. Despertador"
  hide_entity: true
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.alarm_clock_time_long.state }}'
  condition:
    condition: state
    entity_id: input_boolean.alarm_clock_status
    state: 'on'
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.google_home
      volume_level: '{{ states.input_number.alarm_clock_volume.state }}'
  - service: tts.google_say
    entity_id: media_player.google_home
    data_template:
      message: '{{ states.input_text.text_clock.state }}'
  - delay:
      seconds: 6
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: 'Temperatura {{ states.sensor.dark_sky_temperature.state | int }} graus. A previsão para as próximas 24h é: {{ states.sensor.dark_sky_hourly_summary.state }} . E para os próximos dias será: {{ states.sensor.dark_sky_daily_summary.state }} '
  - delay:
      seconds: 30
  - service: media_extractor.play_media
    entity_id: media_player.google_home
    data_template:
      media_content_id: '{{ states.input_text.text_url_youtube.state }}'
      media_content_type: video/youtube
  id: e42ceff3366d4250a6fdefb5db6d3627

#
# CLIMATIZADOR
#
- alias: Programacao Temperatura Ar (IR)
  initial_state: 'on'
  hide_entity: true
  trigger:
  - platform: state
    entity_id: input_number.temperatura_ar
  action:
  - service: switch.broadlink_send_packet_100_64_0_26
    data_template:
      packet: "{% if is_state(\"input_number.temperatura_ar\", \"17.0\") %}\n  - 'JgDKAI+PETUQFBA2ETYQFBATEDcREhAUETYQExESETYQNxATEDcRExESERIRNhA3EDYTNBI1ETYQNhA3ERIRExESERMQExETEBMQFBATETYSERAUERIQNxE2EjQQNxESETYRNhE2EKqNkBE2EBMQNxA2ERMQExE2EBQQExA3EBMRExE1ETYQFBA2ERMREhETEDcQNhA3EDcRNRA3EDcRNRETEBMRExATERMQExETEBMRExI0ERMQExETETYQNhE2ETUSEhA2ETcQNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"18.0\") %}\n  - 'JgDKAI2QEDYSEhE2EDYRExESEDcQExETEDcQExAUETUQNxATETYSEhESEBQQNBM2ETYQNhI1ETYQNhI1ERMSERETEBMQFBESEBQQExA2ETYRExATEBQQNxA2ETYREhETETURNhE2EKiQjxI1ERIQNxE2EBMQFBA2EBQREhA3EBQQExE2EDYRExE2EBMSEhATEDcQNhA3EDcQNhE2EDcQNxATEBMRExATERMQExETERIRNBI3EBMQFBATEDcRNhAzExQQExA3EDYRNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"19.0\") %}\n  - 'JgDKAI6PETURExA2EjURExATETYREhETETYREhESETYRNhESETYRExATERIRNhE2EDYRNhA3ETYRNRE2ERIRExESERMREhAUERIRNhE2EDYQFBESERMQNhE2ERMQExMQETYRNhA3EKqNkBE2ERIRNhE2ERIQExE2ERMREhA3ERIRExE1EjURExE1ERMREhETEDcRNRI1EDYSNRE2ETYRNRETEBMRExATEBQREhETETURNhA2EhIQFBESETYRNRISEBMQFBE2ETURNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"20.0\") %}\n  - 'JgDKAI2QETUQFBA3EDURFBESETYREhAUEDcREhETETURMxQSETYRExATEBQSNBE2EDYRNhE2EDcRNRI1ERIRExESEhIREhETERIRNhETETUQFBESERMQNhE2EBQRNRETETYQNhE2EaqOjxE2ERIQNxA3EBMQFBE1EBQQExE2ERIRExE2ETURExI1ERIQFBATEDcRNRE2EDcRNRA3ETYRNRETERIRExATERMREhETEDYRExE2ERIRExESEDcQNhETETYQExE2ETYQNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"21.0\") %}\n  - 'JgDKAI2PETYQFBEzEzYREhETETURExESEjURExESETYRNRETETYQExETERIRNhE1ETYRNhA2ETYRNhA2ERMQExETERIRExATETYRNhESETYREhAUERIRNhESERMRNhESEDcQNhE2EKuOjxA3EBMRNhE2ERIQFBE1EBQREhE2ERMREhA3ETURExE2EBMQFBESETYRNRE2ETYRNRE2ETYRNRETEBMRExESERMREhE2ETYQExE2ERIRExATETYQExETETYREhA3ETURNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"22.0\") %}\n  - 'JgDKAI2PEjURExA2ETYQExETEDcREhETETUTERESETYRNhESEDcREhETEBMRNhA3EDYRNhE1ETYRNhA3ERIRExESEBMRExATETYRNhE2ETURExESERMRNRETERIQFBESEDcRNRE2EKuNjxE2ERISNRE2ERIRExE1ERMQExE2EBQREhE2EDYRExA3ERIQFBESETYQNhE2ETYRNRE2EDcRNRETERIQFBESERMQExA3ETYRNRE2ERIRExESETYRExATERIRExA2EjURNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"23.0\") %}\n  - 'JgDKAI6PEjURExE1ETYQExETETYREhETETURExESETYRNhATEDQUEhETERIRNhE2ETURNhE2ETURNhA3ERIRExESERMREhAUETURExE2ETUQFBESERMRNRETEDcREhESEjURNhE1EaiQkBE1ERMQNxE1ERMQExA3ERIRExE1EhIREhE2ETYQExE2ERIRExATETYRNhE1ETYRNhE1ETYRNhATEBQREhETERIRExE1ERMRNhE1ERMREhAUEDYRExE2EBMQFBE1ETYRNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"24.0\") %}\n  - 'JgDOAAkACkCNjxI1ERMRNRI1ERIRExE0ExIQFBE1ERMQExA3EDcREhE2ERIRExESETYRNhE1ETYRNhA2ETYRMxQSERMREhETERIRExE1ERMREhE2ERIQFBESEDcREhE2ETYREhA3ETYRNRGrjZARNRETETURNhETERIRNhATERMRNRETERIRNhE2EBMRNhESERMREhE2ETYRNRE2ETYRNRE0EzYREhETEBMRExATERMQNhETERIRNhESERMQExE2ERMQNhE2ERIRNhE2ETQTAA0FAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"25.0\") %}\n  - 'JgDKAI2QETYQExE2ETURExESETYRExESETQTEhETETURNhETETURExESERMRNRE2ETYRNRE2ETYQNxE1ERMQExETEBMQFBA2EDcREhAUEzMSEhESERMREhETETYSNBETETURNhE2EamOjxE2EBMRNhE2EhERExA2ERMQExE2EBMSEhE2EDYRExE2ERIRExATEDcRNRE2ETYQNhE2ETYRNRETERIQFBATEBQRNRI1ERMREhA3EhERExESERMQExA3ETURExA3ETUQNxAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"26.0\") %}\n  - 'JgDKAI2QETYQExE2ETUSEhATETYRExATEDcREhETEDYRNhETEDYRExESERMRNRI1ETYRNRE2ETYRNhE1ERMREhETEBMRExE1ETYREhE2ETYREhETERIQFBESETYQExETETURNhE2EKqPjhE2ERIQNxE2ERIQExI1EBQREhA3ERIRExE2ETURExI0ERMREhETETYRNRE2ETUSNRI1ETYRNRAUERIRExATERMRNRE2ExARNhE2EBMQFBESERMQExE2ERIRExE1ETYQNxAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"27.0\") %}\n  - 'JgDKAI2QETURExE2ETURExESEDcREhETEDYSEhESEDcQNxESETYREhMRERIQNxE2ETQSNRE3ETURNhE2EBMRExESERIRExE2EhEQFBA2EDcTEBETERIQFBA2EjURExESEDcQNhE2EaqNjxE2ERIRNhA3ERIRExE1ERMREhE2ERMQExA3ETURExE2EBMRExATETYRNRE2ETYRNRA3ETYRNRISERIRExESERMRNRETERIRNhE0ExIRExATERMRNRE2ERIRExA3EDYRNhEADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"28.0\") %}\n  - 'JgDKAIyREDYRExA3EDYRExESETYREhAUETUSEhESETYRNhESEDcREhETERIRNhE2ETURNhE2ETUSNRA3ERIQFBESERMREhA3EBMQFBATETYREhETEBMQFBA3ETURNhATETYRNhE1EauOjxE1ERMQNhE2ERMREhA3EBMQFBE1ERMREhE2ETURExE2ERIRExATETYRNhA2ETQSNxA2ETYRNhESERMQExETEBMQNxIREBQREhA3ERIRExATERMQNxE1ETYREhE2ETYQNhEADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"29.0\") %}\n  - 'JgDKAI6QEDYRExE1ETYREhETETYREhETEDYRExESEDcRNhESEDcREhETERITNBE2ETUQNxE1ETYRNhA3ERIRExESERMREhA3EBMQNxESETYRExESERMREhE2ERIRNhAUEDYRNhE2EaqOjxI0ERMRNhA2ERMREhE2ERIRExE2ERIRExE1EDcREhE2ERMREhETETURNhE2ETMTNhA3ETURNhESERMREhETERIRNhESETYRExE1ERMREhETERIRNhETETURExE2ETURNhAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% elif is_state(\"input_number.temperatura_ar\", \"30.0\") %}\n  - 'JgDKAI2QETYREhA3ETYQExETEDYRExESETYRExESETYRNRETETYREhETEBMQNhI1ETYRNRI1EDcRNhE1ERMREhETERIQFBE1ERMRNhE1ETYREhETEBMRExE2ERIQFBATEDcQNhE2EKyOjhE2ERIRNRI2ERIQFBE1ERMREhA3ERMQExE2ETUQFBA3ERIRExESETYRNRE2ETYRNRE2EzQRNRETEBMRExESERMRNRISEDcRNRE2ERIRExESERMRNhESERMREhA3EDQUNRAADQUAAAAAAAAAAAAAAAAAAA=='\n\
        {% else %}\n  none\n{% endif %}\n"
  id: bc0f622eff874a488fad2da85db094b4


#
# ALARME
#
- alias: "Alarme - Notif. quando for ativado"
  hide_entity: false
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: armed_away
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: armed_home
  action:
  - service: script.turn_on
    entity_id: script.reseta_sensores
  - service: switch.turn_on
    data:
      entity_id: switch.Sirenes
  - service: switch.turn_off
    data:
      entity_id: switch.Sirenes
  - service: notify.telegramrudi
    data:
      message: Alarme ativado {% if is_state('alarm_control_panel.alarme_da_casa',
        'armed_away') %}com delay de 10s.{% else %}instantaneamente.{% endif %}
  - service: notify.telegramflavia
    data:
      message: Alarme ativado {% if is_state('alarm_control_panel.alarme_da_casa',
        'armed_away') %}com delay de 10s.{% else %}instantaneamente.{% endif %}
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.casa
      volume_level: 0.6
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: Alarme ativado
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: Alarme ativado

- alias: "Alarme - Aviso ativando em 10s"
  hide_entity: false
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: pending
  action:
#  - service: media_player.volume_set
#    data_template:
#      entity_id: media_player.google_home
#      volume_level: 0.4
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: Ativando alarme em 10 segundos.
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: Ativando alarme em 10 segundos.
  - service: switch.turn_on
    data:
      entity_id: switch.Sirenes
  - service: switch.turn_off
    data:
      entity_id: switch.Sirenes

- alias: "Alarme - Aviso desativado"
  hide_entity: false
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: disarmed
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.sirenes
  - service: switch.turn_off
    data:
      entity_id: switch.Sirenes
  - service: notify.telegramrudi
    data:
      message: Alarme desativado!
  - service: notify.telegramflavia
    data:
      message: Alarme desativado!
#  - service: media_player.volume_set
#    data_template:
#      entity_id: media_player.google_home
#      volume_level: 0.4
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: Alarme desativado!
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: Alarme desativado!

- alias: "Alarme - Disparar (Armado em casa)"
  hide_entity: false
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id:
      - binary_sensor.sala_social
      - binary_sensor.corredor
      - binary_sensor.porta_varanda
      - binary_sensor.porta_entrada
      - binary_sensor.porta_area
      - binary_sensor.janela_closet
      - binary_sensor.janela_cozinha
      - binary_sensor.janela_suite
      - binary_sensor.janela_quarto_f
      - binary_sensor.janela_quarto_m
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_home
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.Sirenes
  - service: light.turn_on
    data:
      entity_id:
        - group.all_lights
  - service: notify.telegramrudi
    data:
      message: Alarme disparou! (Armado em casa)
  - service: notify.telegramrudi
    data_template:
      message: >
        Sensor: {{ trigger.to_state.attributes.friendly_name }}
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: Disparando alarme (Em casa)

- alias: "Alarme - Disparar (Sem ninguém)"
  hide_entity: false
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id:
      - binary_sensor.Sala_Social
      - binary_sensor.corredor
      - binary_sensor.Porta_Varanda
      - binary_sensor.Porta_Entrada
      - binary_sensor.Porta_Area
      - binary_sensor.Janela_Closet
      - binary_sensor.Janela_Cozinha
      - binary_sensor.Janela_Suite
      - binary_sensor.Janela_Quarto_F
      - binary_sensor.Janela_Quarto_M
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.Sirenes
  - service: light.turn_on
    data:
      entity_id:
        - group.all_lights
  - service: notify.telegramrudi
    data:
      message: Alarme disparou! (Sem ninguém)
  - service: notify.telegramrudi
    data_template:
      message: >
        Sensor: {{ trigger.to_state.attributes.friendly_name }}
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.casa
      volume_level: 0.7
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: Corre pega a 12 que o bicho vai pegar!
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: Corre pega a 12 que o bicho vai pegar!

- alias: "Alarme - Desliga sirene ao desativar"
  hide_entity: false
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: disarmed
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.Sirenes

#
# CONTROLES DIGOO
# ACOES

# Controle 1
- alias: Controle (1) - Armar
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_alarme
    from: 'off'
    to: 'on'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data:
      entity_id: alarm_control_panel.alarme_da_casa
      code: 123

- alias: Controle (1) - Desarmar
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_alarme
    from: 'on'
    to: 'off'
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      entity_id: alarm_control_panel.alarme_da_casa
      code: 123
#  - service: mqtt.publish
#    data:
#      topic: "tele/sonoffBr1/RESULT"
#      payload: "921052"
#  - service: mqtt.publish
#    data:
#      topic: "tele/sonoffBr1/RESULT"
#      payload: "77B0D2"

# Controle 2
- alias: Controle (2) - Armar
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_alarme
    from: 'off'
    to: 'on'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data:
      entity_id: alarm_control_panel.alarme_da_casa
      code: 123

- alias: Controle (2) - Desarmar
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_alarme
    from: 'on'
    to: 'off'
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      entity_id: alarm_control_panel.alarme_da_casa
      code: 123
#  - service: mqtt.publish
#    data:
#      topic: "tele/sonoffBr1/RESULT"
#      payload: "2970D2"
#  - service: mqtt.publish
#    data:
#      topic: "tele/sonoffBr1/RESULT"
#      payload: "921052"

# Controle 3
- alias: Controle (3) - Armar
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_alarme
    from: 'off'
    to: 'on'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data:
      entity_id: alarm_control_panel.alarme_da_casa
      code: 123

- alias: Controle (3) - Desarmar
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_alarme
    from: 'on'
    to: 'off'
  action:
  - service: alarm_control_panel.alarm_disarm
    data:
      entity_id: alarm_control_panel.alarme_da_casa
      code: 123
#  - service: mqtt.publish
#    data:
#      topic: "tele/sonoffBr1/RESULT"
#      payload: "2970D2"
#  - service: mqtt.publish
#    data:
#      topic: "tele/sonoffBr1/RESULT"
#      payload: "77B0D2"
      

# Reseta botões Home/SOS Controle 1
- alias: Controle (1) - Auto 1s Btn Home
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_home
    from: 'off'
    to: 'on'
    for:
      seconds: 1
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"2970D4off"}} '

- alias: Controle (1) - Auto 1s Btn SOS
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_sos
    from: 'off'
    to: 'on'
    for:
      seconds: 1
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"2970D8off"}} '

# Reseta botões Home/SOS Controle 2
- alias: Controle (2) - Auto 1s Btn Home
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_home
    from: 'off'
    to: 'on'
    for:
      seconds: 1
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"921054off"}} '

- alias: Controle (2) - Auto 1s Btn SOS
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_sos
    from: 'off'
    to: 'on'
    for:
      seconds: 1
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"921058off"}} '

# Reseta botões Home/SOS Controle 3
- alias: Controle (3) - Auto 1s Btn Home
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_home
    from: 'off'
    to: 'on'
    for:
      seconds: 1
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"77B0D4off"}} '

- alias: Controle (3) - Auto 1s Btn SOS
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_sos
    from: 'off'
    to: 'on'
    for:
      seconds: 1
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"77B0D8off"}} '

#
# Ações Home/SOS Controles
#
# SOS
- alias: Controle (1) - Btn SOS
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_sos
    from: 'off'
    to: 'on'
  action:
# ... programar algo ...
  - service: notify.telegramrudi
    data:
      message: SOS!! Controle 1 está em perigo.
  - service: switch.turn_on
    data:
      entity_id: switch.sonoff
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: SOS!! Controle 1 está em perigo.

- alias: Controle (2) - Btn SOS
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_sos
    from: 'off'
    to: 'on'
  action:
# ... programar algo ...
  - service: notify.telegramrudi
    data:
      message: SOS!! Controle 2 está em perigo.
  - service: switch.turn_on
    data:
      entity_id: switch.sonoff
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: SOS!! Controle 2 está em perigo.

- alias: Controle (3) - Btn SOS
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_sos
    from: 'off'
    to: 'on'
  action:
# ... programar algo ...
  - service: notify.telegramrudi
    data:
      message: SOS!! Controle 3 está em perigo.
  - service: switch.turn_on
    data:
      entity_id: switch.sonoff
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: SOS!! Controle 3 está em perigo.

# HOME
- alias: Controle (1) - Btn Home
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_home
    from: 'off'
    to: 'on'
  action:
# ... programar algo ...
  - service: notify.telegramrudi
    data:
      message: Botão home acionado no controle 1.
  - service: switch.turn_on
    data:
      entity_id: switch.Suite
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: Botão home acionado no controle 1.

# Liga luz do abajur 
- alias: Controle (2) - Btn Home
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_home
    from: 'off'
    to: 'on'
  action:
  - service: light.turn_on
    data:
      entity_id: light.abajur_da_suite
# ... programar algo ...
#  - service: notify.telegramrudi
#    data:
#      message: Botão home acionado no controle 2.
#  - service: switch.turn_on
#    data:
#      entity_id: switch.Suite
#  - service: tts.voicerss_say
#    data_template:
#      entity_id: media_player.google_home
#      message: Botão home acionado no controle 2.

- alias: Controle (3) - Bt Home (Liga abajur)
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_home
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.Abajur_da_Suite
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.abajur_da_suite
      transition: 3

- alias: Controle (3) - Bt Home (Desligar abajur)
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_home
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.Abajur_da_Suite
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.abajur_da_suite
      transition: 3

# ... programar algo ...
#  - service: notify.telegramrudi
#    data:
#      message: Botão home acionado no controle 3.
#  - service: switch.turn_on
#    data:
#      entity_id: switch.Suite
#  - service: tts.voicerss_say
#    data_template:
#      entity_id: media_player.google_home
#      message: Botão home acionado no controle 3.

#
# SENSORES FECHAMENTO AUTOMATICO
#
- alias: "FS.W Quarto M"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.janela_quarto_m
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"996D46off"}} '
- alias: "FS.W Quarto F"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.janela_quarto_f
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"CD5B46off"}} '
- alias: "FS.W Suite"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.janela_suite
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"B92D46off"}} '
- alias: "FS.D Varanda"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.porta_varanda
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"5E6B46off"}} '
- alias: "FS.W Cozinha"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.janela_cozinha
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"C41B46off"}} '
- alias: "FS.P Sala Social"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.sala_social
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"9B5086off"}} '
- alias: "FS.P Corredor"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.corredor
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"82C186off"}} '

- alias: "FS.P Ext Piscina"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_piscina
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"EE4986off"}} '
- alias: "FS.P Ext Garagem"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_garagem
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"AAC186off"}} '
- alias: "FS.W Sala Jantar"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.sala_jantar
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"55A486off"}} '
- alias: "FS.D Entrada"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.porta_entrada
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"2E9D46off"}} '
- alias: "FS.W Closet"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.janela_closet
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"7F7D46off"}} '
- alias: "FS.D Area"
  hide_entity: true
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: binary_sensor.porta_area
    from: 'off'
    to: 'on'
    for:
      seconds: 2
  action:
  - service: mqtt.publish
    data:
      topic: "tele/sonoffBr1/RESULT"
      payload: ' {"RfReceived":{"Data":"09D8C6off"}} '


#
# LUZES
#

- alias: Luz Sem desligar - Banheiro Suite
  hide_entity: false
  initial_state: true
  trigger:
    platform: state
    entity_id: light.banheiro_suite
    from: 'off'
    to: 'on'
    for:
      minutes: 40
  action:
  - service: light.turn_off
    entity_id: light.banheiro_suite
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: "Oops! Desliguei a luz do banheiro da suíte. Estava ligada por muito tempo. Vamos poupar luz que aqui ninguém é dono da RGE."
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: "Oops! Desliguei a luz do banheiro da suíte. Estava ligada por muito tempo. Vamos poupar luz que aqui ninguém é dono da RGE."

- alias: Luz Sem desligar - Banheiro Social
  hide_entity: false
  initial_state: true
  trigger:
    platform: state
    entity_id: light.banheiro_social
    from: 'off'
    to: 'on'
    for:
      minutes: 40
  action:
  - service: light.turn_off
    entity_id: light.banheiro_social
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: "Oops! Desliguei a luz do banheiro Social. Estava ligada por muito tempo. Vamos poupar luz que aqui ninguém é dono da RGE."
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: "Oops! Desliguei a luz do banheiro Social. Estava ligada por muito tempo. Vamos poupar luz que aqui ninguém é dono da RGE."

- alias: Luz Sem desligar - Lavabo
  hide_entity: false
  initial_state: true
  trigger:
    platform: state
    entity_id: light.lavabo
    from: 'off'
    to: 'on'
    for:
      minutes: 10
  action:
  - service: light.turn_off
    entity_id: light.lavabo
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: "Oops! Desliguei a luz do lavabo. Estava ligada por muito tempo. Vamos poupar luz que aqui ninguém é dono da RGE."
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: "Oops! Desliguei a luz do lavabo. Estava ligada por muito tempo. Vamos poupar luz que aqui ninguém é dono da RGE."


- alias: Luz Corredor Liga - 20h as 07:30 (Movimento)
  hide_entity: false
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.corredor
    from: 'off'
    to: 'on'
  condition:
    condition: time
    after: '19:00:00'
    before: '07:30:00'
  action:
    service: light.turn_on
    entity_id: light.corredor

- alias: Luz Corredor Desliga - (S/Movimento 2min)
  hide_entity: false
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.corredor
    to: 'off'
    for:
      minutes: 2
  condition:
    condition: time
    after: '18:00:00'
    before: '08:30:00'
  action:
    service: light.turn_off
    entity_id: light.corredor

- alias: "Luz Arandelas - Ligar"
  hide_entity: false
  initial_state: 'off'
  trigger:
#    - platform: time
#      at: '19:30:00'
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.arandelas_on.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.arandelas
        - light.arandela_varanda_suite


- alias: "Luz Arandelas - Desligar"
  hide_entity: false
  initial_state: 'off'
  trigger:
#    - platform: time
#      at: '23:00:00'
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.arandelas_off.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  action:
  - service: light.turn_off
    data:
      entity_id:
        - light.arandelas
        - light.arandela_varanda_suite

- alias: "Luz Postes - Ligar"
  hide_entity: false
  initial_state: 'on'
  trigger:
#    - platform: time
#      at: '19:30:00'
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.poste_on.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.postes

- alias: "Luz Postes - Desligar"
  hide_entity: false
  initial_state: 'on'
  trigger:
#    - platform: time
#      at: '23:00:00'
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.poste_off.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  action:
  - service: light.turn_off
    data:
      entity_id:
        - light.postes


# MOVIMENTO SUSPEITOS COM ALARME ATIVO (ALERTA VOZ, E LUZES EXTERNAS LIGAM)

- alias: "Movimento (Alarme ON) - Garagem"
  hide_entity: false
  initial_state: 'off'
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_garagem
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.google_home
      volume_level: 0.3
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: "Opa! Movimento suspeito na garagem."
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.casa
      volume_level: 0.7
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: "Opa! Movimento suspeito na garagem."
  - service: light.turn_on
    data:
      entity_id:
        - group.luzes_externas
  - service: notify.telegramrudi
    data:
      message: Movimento na Garagem
  - service: camera.snapshot
    data:
      entity_id: camera.wanscam_360
      filename: '/tmp/snapshot.jpg'
  - service: notify.telegramrudi
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot
#  - service: media_extractor.play_media
#    entity_id: media_player.google_home
#    data_template:
#      media_content_id: 'https://www.youtube.com/watch?v=SGFQ6Rd1kWA'
#      media_content_type: video/youtube

- alias: "Movimento (Alarme ON) - Piscina"
  hide_entity: false
  initial_state: 'off'
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_piscina
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.google_home
      volume_level: 0.4
  - service: tts.google_say
    data_template:
      entity_id: media_player.google_home
      message: "Opa! Movimento suspeito na aréa da piscina."
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.casa
      volume_level: 0.7
  - service: tts.google_say
    data_template:
      entity_id: media_player.casa
      message: "Opa! Movimento suspeito na aréa da piscina."
  - service: light.turn_on
    data:
      entity_id:
        - group.luzes_externas
  - service: notify.telegramrudi
    data:
      message: Movimento na Garagem
  - service: camera.snapshot
    data:
      entity_id: camera.camera_interna
      filename: '/tmp/snapshot.jpg'
  - service: notify.telegramrudi
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot
#  - service: media_extractor.play_media
#    entity_id: media_player.google_home
#    data_template:
#      media_content_id: 'https://www.youtube.com/watch?v=SGFQ6Rd1kWA'
#      media_content_type: video/youtube


# MOVIMENTO ALARME DESATIVADO. (CONFIGURAR VOZ)

- alias: "Movimento (Alarme OFF) - Piscina"
  hide_entity: false
  initial_state: on
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_piscina
    from: 'off'
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: alarm_control_panel.alarme_da_casa
        state: disarmed
      - condition: or
        conditions:
          - condition: state
            entity_id: group.all_devices
            state: 'not_home'
          - condition: state
            entity_id: group.all_devices
            state: 'unknown'
  action:
  - service: camera.snapshot
    data:
      entity_id: camera.camera_interna
      filename: '/tmp/snapshot.jpg'
  - service: notify.telegramrudi
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot
  - service: notify.telegramrudi
    data:
      message: Movimento na Area da Piscina
  - service: notify.telegramflavia
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot
  - service: notify.telegramflavia
    data:
      message: Movimento na Area da Piscina

- alias: "Movimento (Alarme OFF) - Garagem"
  hide_entity: false
  initial_state: on
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_garagem
    from: 'off'
    to: 'on'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: alarm_control_panel.alarme_da_casa
        state: disarmed
      - condition: or
        conditions:
          - condition: state
            entity_id: group.all_devices
            state: 'not_home'
          - condition: state
            entity_id: group.all_devices
            state: 'unknown'
  action:
  - service: camera.snapshot
    data:
      entity_id: camera.wanscam_360
      filename: '/tmp/snapshot.jpg'
  - service: notify.telegramrudi
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot
  - service: notify.telegramrudi
    data:
      message: Movimento na Garagem
  - service: notify.telegramflavia
    data:
      message: Capturado!
      data:
        photo:
          - file: "/tmp/snapshot.jpg"
            capture: Snapshoot
  - service: notify.telegramflavia
    data:
      message: Movimento na Garagem


- alias: "Alarme - Testar Sensores"
  hide_entity: false
  initial_state: off
  trigger:
  - platform: state
    entity_id:
      - binary_sensor.sala_social
      - binary_sensor.sala_jantar
      - binary_sensor.corredor
      - binary_sensor.ext_garagem
      - binary_sensor.ext_piscina
      - binary_sensor.porta_varanda
      - binary_sensor.porta_entrada
      - binary_sensor.porta_area
      - binary_sensor.janela_closet
      - binary_sensor.janela_cozinha
      - binary_sensor.janela_suite
      - binary_sensor.janela_quarto_f
      - binary_sensor.janela_quarto_m
    to: 'on'
  action:
  - service: notify.telegramrudi
    data_template:
      message: >
        [OK] : {{ trigger.to_state.attributes.friendly_name }}